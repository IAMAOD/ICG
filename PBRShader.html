<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Three.js GLB Demo</title>
  <style>
    html,body{margin:0;height:100%;overflow:hidden}
    #app{width:100%;height:100vh;display:block}
    #ui{
      position:absolute;top:10px;left:10px;
      background:rgba(0,0,0,0.6);color:#fff;
      padding:6px 10px;border-radius:6px;
      font-family:sans-serif;z-index:10
    }
  </style>
</head>
<body>
<div id="app"></div>
<div id="ui">Loading: <span id="progress">0%</span></div>

<script type="module">
import * as THREE from 'https://unpkg.com/three@0.158.0/build/three.module.js';
import { OrbitControls } from 'https://unpkg.com/three@0.158.0/examples/jsm/controls/OrbitControls.js';
import { GLTFLoader } from 'https://unpkg.com/three@0.158.0/examples/jsm/loaders/GLTFLoader.js';

const MODEL_URL = './horse_bust.glb';  // ✅ ใช้ relative path

const container = document.getElementById('app');
const progEl = document.getElementById('progress');

// scene, camera, renderer
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xf0f0f0);

const camera = new THREE.PerspectiveCamera(45, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0, 0.8, 2.5);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
renderer.outputEncoding = THREE.sRGBEncoding;
container.appendChild(renderer.domElement);

// controls
const controls = new OrbitControls(camera, renderer.domElement);
controls.target.set(0,0.6,0);
controls.enableDamping = true;

// lights
scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 0.6));
const dl = new THREE.DirectionalLight(0xffffff, 0.9);
dl.position.set(5,10,7.5);
scene.add(dl);

// ground
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(20,20),
  new THREE.MeshStandardMaterial({color:0xeeeeee})
);
ground.rotation.x = -Math.PI/2;
ground.position.y = 0;
ground.receiveShadow = true;
scene.add(ground);

// load model
const loader = new GLTFLoader();
loader.load(MODEL_URL,
  (gltf)=>{
    const root = gltf.scene || gltf.scenes[0];
    // center model
    const box = new THREE.Box3().setFromObject(root);
    const size = new THREE.Vector3(); box.getSize(size);
    const center = new THREE.Vector3(); box.getCenter(center);

    root.position.x -= center.x;
    root.position.z -= center.z;
    root.position.y -= box.min.y;

    const maxDim = Math.max(size.x,size.y,size.z);
    if (maxDim>0) root.scale.setScalar(1.6/maxDim);

    scene.add(root);
    progEl.textContent = 'Loaded';
  },
  (xhr)=>{
    if (xhr.total) {
      progEl.textContent = Math.round((xhr.loaded/xhr.total)*100)+'%';
    } else {
      progEl.textContent = Math.round(xhr.loaded/1000)+' KB';
    }
  },
  (err)=>{
    console.error(err);
    progEl.textContent = 'Error (check console)';
  }
);

// resize
window.addEventListener('resize', ()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});

// loop
function animate(){
  requestAnimationFrame(animate);
  controls.update();
  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
